"use strict";define("WIT/ProcessTemplateSelector",["require","exports","react","VSSUI/Button","VSSUI/Callout","VSSUI/Link","VSS/Core/Util/Object","VSS/Platform/Layout","VSSUI/Dropdown","VSSUI/FormItem","VSSUI/Icon","VSSUI/Util","VSSUI/Utilities/DropdownSelection","VSS/Core/Util/String"],(function(e,t,s,o,l,i,a,r,n,c,p,d,h,m){var u,T,S,I;u=t[I="Resources"]={},t[I].DropdownChevronExpandAriaLabel="Expand menu options",t[I].DropdownChevronCollapseAriaLabel="Collapse menu options",t[I].CloseDialogButtonLabel="Close",t[I].LearnMoreText="Learn more",t[I].ProcessTemplateToolTip="Select the work item process to plan and track work.",t[I].WorkItemProcessSectionHeader="Work item process",t[I].WorkItemProcessLearnMoreAriaLabel="Learn more about selecting the right work item process template.",t[I].ProcessTemplateLearnMoreLink="https://go.microsoft.com/fwlink/?LinkID=825688",t[I].ProcessTemplateHelpToolTip="Select the right work item process to create a team project.",t[I].ShowDescriptionText="Show description",t[I].ShowDescriptionLinkAriaLabel="Show description for selected custom work item process",function(e){T=t[e]={};class n extends r.VssComponent{constructor(e,t){super(e,t),this._saveElement=e=>{this._element=e},this._onIconClick=()=>{this.setState({isCalloutVisible:!this.state.isCalloutVisible})},this._onCalloutDismiss=()=>{this.setState({isCalloutVisible:!1})},this.state={isCalloutVisible:!1},this._id=(0,a.getId)("link-callout"),this._calloutId=this._id+"-callout",this._calloutTextId=this._calloutId+"-text",this._calloutTitleId=this._calloutId+"-title"}render(){const{linkText:e,linkOrigin:t={horizontal:"start",vertical:"center"},calloutText:a,tooltip:r,ariaLabel:n,calloutOrigin:c={horizontal:"end",vertical:"center"},calloutTextToolTip:p,calloutTitle:d,calloutTitleToolTip:h,learnMoreUrl:m,gapSpace:T}=this.props;return s.createElement("div",{className:"link-callout",ref:this._saveElement,title:r,"aria-label":n},s.createElement(i.Link,{className:"link-callout-container","aria-owns":this.state.isCalloutVisible?this._calloutId:void 0,onClick:this._onIconClick},s.createElement("span",{className:"text"},e)),this.state.isCalloutVisible&&s.createElement(l.Callout,{"aria-labelledBy":d&&this._calloutTitleId,"aria-describedBy":a&&this._calloutTextId,anchorElement:this._element,anchorOrigin:t,anchorOffset:{horizontal:-5,vertical:0},blurDismiss:!0,calloutOrigin:c,contentClassName:"link-callout-dialog",contentShadow:!0,focuszoneProps:{focusOnMount:!0,includeDefaults:!0},onDismiss:this._onCalloutDismiss,role:"dialog"},s.createElement(o.Button,{subtle:!0,className:"close-callout-button",iconProps:{iconName:"Cancel"},ariaLabel:u.CloseDialogButtonLabel,onClick:this._onCalloutDismiss}),s.createElement("div",{className:"callout-details",id:this._calloutId,tabIndex:-1},d&&s.createElement("div",{id:this._calloutTitleId,className:"title",title:h||"","aria-label":h||""},d),s.createElement("div",{id:this._calloutTextId,className:"text",title:p||"","aria-label":p||""},a),m&&s.createElement(i.Link,{className:"learn-more-link",href:m,target:"_blank",rel:"noopener noreferrer",title:u.LearnMoreText},u.LearnMoreText))))}}t[e].LinkCallout=n}("LinkCallout"),function(e){S=t[e]={};class o extends r.VssComponent{constructor(e,t){super(e,t),this._comboBoxSelection=new h.DropdownSelection,this._onChanged=(e,t)=>{this.props.onOptionChanged(t.id.toString()),this.setState({selectedKey:t.id})},this._getAllExpandedDictionary=()=>{const e={};return this.props.sourceItems.map(((t,s)=>{const o=(t.children||[]).length>0;t.key&&o&&(e[t.key]=!0)})),e},this._getDropdownOptions=e=>{const t=[];return this.props.sourceItems.map(((s,o)=>{if(s.key&&s.text){const o=s.children||[],l=o.length>0,i=e[s.key];t.push({id:s.key,text:s.text,data:{isInheritedItem:!1,hasInheritedItems:l,isExpanded:i}}),l&&o.forEach(((e,s)=>{e.text&&i&&t.push({id:e.key,text:e.text,data:{isInheritedItem:!0}})}))}})),t},this._dropdownId=this.props.id||(0,a.getId)("drop-down"),this._helpTooltipId=(0,a.getId)("help-tooltip");const s=this._getAllExpandedDictionary(),o=this._getDropdownOptions(s),l=o.find((e=>e.id===this.props.defaultSelectedKey)),i=o[0]?o[0].id:"",r=l?l.id:i;let n=""===r?0:o.findIndex((e=>e.id===r));this._comboBoxSelection.select(n),this.state={dropdownOptions:o,isExpanded:s,selectedKey:r}}render(){return s.createElement("div",null,s.createElement("div",{className:"flex flex-center"},s.createElement(c.FormItem,{label:this.props.label,className:"dropdown-label"},this.props.helpIconProps&&s.createElement(i.Link,{className:"help-icon-container",ariaLabel:this.props.helpIconProps.ariaLabel,ariaDescribedBy:this._helpTooltipId,href:this.props.helpIconProps.href,target:"_blank",rel:"noopener noreferrer",disabled:this.props.disabled,tooltipProps:{anchorOffset:{horizontal:0,vertical:-10},anchorOrigin:{horizontal:"center",vertical:"start"},id:this._helpTooltipId,showOnFocus:!0,text:this.props.helpIconProps.tooltip,tooltipOrigin:{horizontal:"center",vertical:"end"}}},s.createElement(p.Icon,{iconName:"Unknown"})))),s.createElement(n.Dropdown,{className:this.props.className,ariaLabel:this.props.ariaLabel,disabled:this.props.disabled,selection:this._comboBoxSelection,onSelect:this._onChanged,items:this.state.dropdownOptions,calloutContentClassName:(0,d.css)("dropdown-callout",this.props.calloutClassName)}))}}t[e].SimpleComboBox=o}("SimpleComboBox"),function(e){t.ProcessTemplateSelector={};class o extends r.VssComponent{constructor(e,t){super(e,t),this._onOptionChanged=e=>{const t=this.state.processTemplates.find((t=>t.typeId===e))||this.state.currentProcessTemplate;this.props.onSelectedOptionChanged(o.PROCESS_TEMPLATE_SELECTOR_KEY,t.typeId),this.setState({currentProcessTemplate:t})},this.state={processTemplates:[],processTemplatesOptionItems:[],currentProcessTemplate:{}}}componentDidMount(){super.componentDidMount(),this._loadProcessTemplates()}render(){const e=!this.state.currentProcessTemplate.isSystemTemplate&&this.state.currentProcessTemplate.description;return s.createElement("div",{className:this.props.className},this.state.processTemplatesOptionItems.length>0&&s.createElement(s.Fragment,null,s.createElement(S.SimpleComboBox,{ariaLabel:u.ProcessTemplateToolTip,label:u.WorkItemProcessSectionHeader,helpIconProps:{ariaLabel:u.WorkItemProcessLearnMoreAriaLabel,href:u.ProcessTemplateLearnMoreLink,tooltip:u.ProcessTemplateHelpToolTip},sourceItems:this.state.processTemplatesOptionItems,defaultSelectedKey:this.state.currentProcessTemplate.typeId,disabled:this.props.disabled,onOptionChanged:this._onOptionChanged,className:"process-template-selector-dropdown",calloutClassName:"process-template-selector-callout"}),e&&s.createElement(T.LinkCallout,{linkText:u.ShowDescriptionText,ariaLabel:u.ShowDescriptionLinkAriaLabel,calloutTitle:this.state.currentProcessTemplate.name,calloutText:this.state.currentProcessTemplate.description})))}_loadProcessTemplates(){this.trackPromise(this.context.pageContext.getService("IVssContributionService").getDataAsync(o.PROVIDER_ID,void 0,!0)).promise.then((e=>{if(e&&e&&e.length>0){let t=null;const s=this._buildProcessTemplateTree(e);this.props.initialOptions&&(t=this.props.initialOptions[o.PROCESS_TEMPLATE_SELECTOR_KEY]);const l=e.find((e=>!t&&e.isDefault||e.name===t))||e[0];this.setState({processTemplates:e,processTemplatesOptionItems:s,currentProcessTemplate:l}),this.props.onSelectedOptionChanged(o.PROCESS_TEMPLATE_SELECTOR_KEY,l.typeId)}}),(()=>{}))}_buildProcessTemplateTree(e){const t=[],s={};for(let o=0;o<e.length;o++){let l=e[o];if(l.inherits===m.EmptyGuidString||!l.inherits){const e=l.typeId;let o={text:l.name,key:e,children:[]};t.push(o),s[e]=o}}for(let o=0;o<e.length;o++){const l=e[o];if(l.inherits!==m.EmptyGuidString&&l.inherits){const e=s[l.inherits];if(e){let t=e.children;null==t&&(e.children=t=[]),t.push({text:l.name,key:l.typeId})}else{const e={text:l.name,key:l.typeId};t.push(e)}}}return t}}o.PROVIDER_ID="ms.vss-work-web.wit-process-template-provider",o.PROCESS_TEMPLATE_SELECTOR_KEY="processTemplateSelector",r.Components.add("WIT.ProcessTemplateSelector",o)}()}),["Resources","LinkCallout","SimpleComboBox","ProcessTemplateSelector"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-work-web.wit-process-template-selector-content"}}));