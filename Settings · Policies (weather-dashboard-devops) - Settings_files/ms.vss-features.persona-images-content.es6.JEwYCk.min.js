"use strict";define("VSS/Features/PersonaImages",["require","exports","react","VSS/Platform/AuthenticatedBlobService","VSS/Platform/Layout","VSSUI/Image","VSSUI/Persona","VSS/Platform/Trace","VSSUI/VssPersona"],(function(e,t,n,r,s,a,o,i,c){var l;!function(e){l=t[e]={},Object.defineProperty(t[e],"Image",{enumerable:!0,get:function(){return a.Image}});function o(e){if(e){if(e.getService("IVssFeatureService").isFeatureFlagEnabled("VisualStudio.Services.WebPlatform.AuthenticatedImages",!1)){const t=e.getService("ITokenProviderService");if(t){const n=t.getSilentProvider();if(n)return{resolveImageUrl:t=>(0,r.getBlobUrl)(e,t,n),onImageLoaded:e=>{e&&e.startsWith("blob:")&&URL.revokeObjectURL(e)}}}}}}t[e].AuthenticatedImage=e=>{let t;const r=(0,s.useComponentContext)();return(null==r?void 0:r.pageContext)&&(t=o(r.pageContext)),n.createElement(a.Image,Object.assign({},e,{imageUrlResolver:t}))},t[e].getImageUrlResolver=o}("AuthenticatedImage"),function(e){t[e]={};class r extends s.VssComponent{constructor(){super(...arguments),this._personaRef=n.createRef()}render(){const e=(0,l.getImageUrlResolver)(this.context.pageContext);return n.createElement(o.Persona,Object.assign({ref:this._personaRef},this.props,{imageUrlResolver:e}))}showIdentityCard(){var e,t;null===(t=null===(e=this._personaRef)||void 0===e?void 0:e.current)||void 0===t||t.showIdentityCard()}}t[e].AuthenticatedPersona=r}("AuthenticatedPersona"),function(e){t[e]={};class a extends s.VssComponent{render(){if(!this.context.pageContext.getService("IVssFeatureService").isFeatureFlagEnabled("VisualStudio.Services.WebPlatform.AuthenticatedImages",!1))return n.createElement(c.VssPersona,Object.assign({},this.props));let e;try{e=this.context.pageContext.getService("ITokenProviderService").getSilentProvider()}catch(e){(0,i.traceException)(this.context.pageContext,"WebPlatform","VssAuthenticatedPersona",e)}return e?n.createElement(o,Object.assign({},this.props,{tokenProvider:e})):n.createElement(c.VssPersona,Object.assign({},this.props))}}t[e].VssAuthenticatedPersona=a;const o=e=>{const{identityDetailsProvider:t,tokenProvider:a,imageUrl:o,displayName:i,size:l="medium"}=e,[d,u]=n.useState(void 0),g=(0,s.useComponentContext)();n.useEffect((()=>{let e=o;t&&(e=t.getIdentityImageUrl((0,c.getSize)(l))),(0,r.getBlobUrl)(g.pageContext,e,a).then((e=>{u(e)}))}),[t,o,l]);const m={getDisplayName:()=>t?t.getDisplayName():i,getIdentityImageUrl:()=>d,onRenderPersonaCard:null==t?void 0:t.onRenderPersonaCard};return n.createElement(c.VssPersona,Object.assign({},e,{imageUrl:"",onLoad:()=>{d&&d.startsWith("blob:")&&URL.revokeObjectURL(d)},identityDetailsProvider:m}))}}("VssAuthenticatedPersona")}),["AuthenticatedImage","AuthenticatedPersona","VssAuthenticatedPersona"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-features.persona-images-content"}}));