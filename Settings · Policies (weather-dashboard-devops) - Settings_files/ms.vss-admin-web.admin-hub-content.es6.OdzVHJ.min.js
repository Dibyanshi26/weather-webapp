"use strict";define("TFS/Admin/Views/AdminHub",["require","exports","VSS/Core/Observable","VSS/Platform/Context","VSS/Platform/FPS","react","VSS/Features/PlatformUI/ContributedTab","VSS/Platform/Feature","VSS/Platform/Layout","VSSUI/Button","VSSUI/Observer","VSSUI/Page","VSSUI/Spinner","VSSUI/Splitter","VSSUI/StackPanel","VSSUI/Tabs","VSSUI/TextField","VSSUI/Icon","VSSUI/List","VSSUI/MasterDetails","VSSUI/MasterDetailsContext","VSSUI/TooltipEx","VSSUI/Util","VSSUI/Utilities/GroupedItemProvider","VSSUI/Utilities/ScreenSize"],(function(e,t,a,i,s,n,r,o,l,c,d,u,h,m,b,p,g,S,v,x,C,P,f,E,I){var T,N;T=t[N="Resources"]={},t[N].AccountSettings="Organization Settings",t[N].CollectionSettings="Collection Settings",t[N].Extensions="Extensions",t[N].ProjectSettings="Project Settings",t[N].Settings="Settings",t[N].UserSettings="User settings",t[N].SearchSettings="Search Settings",t[N].CancelButton="Cancel",t[N].ShowSideMenu="Show side menu",function(e){t[e]={};class n extends i.VssService{constructor(){super(...arguments),this.items=new a.ObservableArray}getBreadcrumbItems(){return this.items}setSelectedPivotBreadcrumb(e,t){this.items.value=[{key:"SelectedPivot",text:e,rank:50,onClick:t?()=>{(0,s.FastPageSwitch)(this.pageContext,t,!0)}:void 0}]}}t[e].AdminHubBreadcrumbService=n,i.Services.add("admin-hub-header-breadcrumb-service",{serviceFactory:n})}("AdminHubBreadcrumbService"),function(e){t.AdminHub={};class i extends l.VssComponent{constructor(e,t){if(super(e,t),this.searchValue=new a.ObservableValue(""),this.textField=n.createRef(),this.onKeyDown=e=>{switch(e.which){case 13:this.searchEnabled.value=!0;break;case 27:this.searchEnabled.value=!1;break;default:return}e.preventDefault(),e.stopPropagation()},this.onTextChanged=(e,t)=>{this.searchValue.value=t},this.onClickClearButton=e=>{this.searchValue.value="",this.textField.current&&this.textField.current.focus()},this.clearButtonIconProps={render:()=>this.searchValue.value?n.createElement(c.Button,{className:"bolt-text-filterbaritem-clear search-clear-button",iconProps:{iconName:"Cancel"},ariaLabel:T.CancelButton,onClick:this.onClickClearButton}):n.createElement("div",null)},this._showSeachTextField=n.createElement("div",{className:"setting-search-textbox"},n.createElement(g.TextField,{ariaLabel:T.SearchSettings,className:"bolt-text-filterbaritem flex-grow",inputClassName:"search-text-field-input",onChange:this.onTextChanged,width:"auto",onKeyDown:this.onKeyDown,maxLength:50,placeholder:T.SearchSettings,ref:this.textField,style:1,suffixIconProps:this.clearButtonIconProps,value:this.searchValue,prefixIconProps:{className:"keyword-filter-icon",iconName:"Search"}})),this.onSelectedTabChanged=e=>{this.selectedTabId.value!==e&&(this.selectedTabId.value=e,this.updatePageTitleAndBreadcrumb(e))},this.peek=()=>this.stackPanel.peek(),this.pop=()=>this.stackPanel.pop(),this.push=e=>this.stackPanel.push(e),this.updatePageTitleAndBreadcrumb=e=>{const t=this.contributionMap[e];if(t&&t.name){const e=this.context.pageContext.getService("ITfsNavigationService");let i=`${T.Settings} · ${t.name}`;this.entityName&&(i+=` (${this.entityName})`),e.setPageTitle(i),this.adminBreadcrumbServie.setSelectedPivotBreadcrumb(a.ObservableLike.getValue(t.name),t.url&&a.ObservableLike.getValue(t.url))}},this.renderTitle=e=>n.createElement("div",{className:"bolt-tablist-title title-m flex-noshrink"},e),this.renderSubTitle=e=>n.createElement("div",{className:"bolt-tablist-subtitle secondary-text flex-noshrink text-ellipsis"},e),this.state={},this.searchEnabled=new a.ObservableValue(!1),"collection"===e.level){const e=t.pageContext.getService("IVssPageService").getData();e&&(this.entityName=e.hostName,e&&e.isHosted?this.name=T.AccountSettings:this.name=T.CollectionSettings)}else if("project"===e.level){this.name=T.ProjectSettings;const e=t.pageContext.getService("ITfsPageService").getData();e&&e.project&&(this.entityName=e.project.name)}else if("user"===e.level){this.name=T.UserSettings;const e=t.pageContext.getService("IVssPageService").getData();e&&e.user&&(this.entityName=e.user.displayName)}this.selectedTabId=new a.ObservableValue(this.getCurrentTab()),this.contributionMap={},this.adminBreadcrumbServie=t.pageContext.getService("admin-hub-header-breadcrumb-service"),this.initialize()}render(){return n.createElement(u.Page,{className:"admin-hub",tabProviders:this.tabProviders,selectedTabId:this.selectedTabId,orientation:1},n.createElement(d.Observer,{searchEnabled:this.searchEnabled},(e=>n.createElement(n.Fragment,null,this.isSplitterEnabled?n.createElement(m.Splitter,{fixedElement:0,splitterDirection:0,minFixedSize:240,maxFixedSize:500,initialFixedSize:240,nearElementClassName:"flex flex-column v-scroll-auto",onRenderNearElement:()=>n.createElement("div",null,this.name&&this.renderTitle(this.name),this.entityName&&this.renderSubTitle(this.entityName),this.isSearchFlagEnabled&&"collection"===this.props.level&&this._showSeachTextField,n.createElement(b.StackPanel,{initialStack:[this.tabListPushItem],ref:e=>this.stackPanel=e})),farElementClassName:"flex flex-column",onRenderFarElement:()=>e.searchEnabled?n.createElement(l.WrappedComponent,{dependencies:["ms.vss-admin-web.settings-search-component"],wrappedType:"ms.vss-admin-web.setting-search-page",wrappedProps:{pageContext:this.context.pageContext,searchTerm:this.searchValue.value}}):n.createElement(b.StackPanelProvider,{push:this.push,pop:this.pop,peek:this.peek},n.createElement(p.TabContent,null))}):n.createElement(n.Fragment,null,n.createElement("div",{className:"legacy-stackpanel-div flex-noshrink"},this.name&&this.renderTitle(this.name),this.entityName&&this.renderSubTitle(this.entityName),this.isSearchFlagEnabled&&"collection"===this.props.level&&this._showSeachTextField,n.createElement(b.StackPanel,{initialStack:[this.tabListPushItem],ref:e=>this.stackPanel=e,className:"legacy-stackpanel"})),n.createElement("div",{className:"flex-column flex-grow v-scroll-auto relative"},e.searchEnabled?n.createElement(l.WrappedComponent,{dependencies:["ms.vss-admin-web.settings-search-component"],wrappedType:"ms.vss-admin-web.setting-search-page",wrappedProps:{pageContext:this.context.pageContext,searchTerm:this.searchValue.value}}):n.createElement(b.StackPanelProvider,{push:this.push,pop:this.pop,peek:this.peek},n.createElement(p.TabContent,null))))))))}componentDidMount(){super.componentDidMount(),this.updatePageTitleAndBreadcrumb(this.selectedTabId.value)}getCurrentTab(){return this.context.pageContext.getService("IVssNavigationService").getRouteValues()[i.PivotParamName]||this.props.defaultPivot||""}initialize(){const e=()=>n.createElement("div",{className:"absolute-fill flex flex-column flex-center justify-center"},n.createElement(h.Spinner,{size:"large"})),t=new a.ObservableCollection,s=this.context.pageContext.getService("IVssContributionService"),l=s.getContributionChildren(this.props.id,"ms.vss-web.tab-group")||[];if(this.groups=[],l.forEach((e=>{(0,r.addTabs)(this.context.pageContext,t,e,{updateUrlOnPivotChange:!0,routeStateKey:i.PivotParamName,fpsRequired:!0,preProcessTabContribution:t=>{this.preProcessContributedTab(t,e)}});const a=s.getContribution(e);a&&this.groups.push({id:e,name:a.name,order:a.rank})})),this.groups.push({id:i.ContributedGroupKey,name:T.Extensions,order:999}),this.props.hubContributionDataProvider){const a=s.getData(this.props.hubContributionDataProvider);a&&t.push(a.contributions,(t=>(0,r.processTabContribution)(this.context.pageContext,{updateUrlOnPivotChange:!0,routeStateKey:i.PivotParamName,fpsRequired:!0,loadingComponent:e,preProcessTabContribution:e=>{this.preProcessContributedTab(e,i.ContributedGroupKey)}},t.properties,t.id)))}t.value.forEach((e=>{this.contributionMap[e.id]=e})),this.contributionMap[this.selectedTabId.value]||(this.selectedTabId.value=t.value[0].id),this.tabProviders=t,this.tabListPushItem={renderContent:()=>n.createElement(p.TabList,{className:"admin-hub-tablist",tabGroups:this.groups,onSelectedTabChanged:this.onSelectedTabChanged})},this.isSplitterEnabled=(0,o.isFeatureFlagEnabled)(this.context.pageContext,i.AdminHubSplitterEnabledFeatureFlag,!1),this.isSearchFlagEnabled=(0,o.isFeatureEnabled)(this.context.pageContext,i.AdminHubSettingsSearchEnabledFeatureId,!1)}preProcessContributedTab(e,t){const a=e;!a.id&&a.itemKey&&(a.id=a.itemKey),a.groupId||(a.groupId=t),!0!==this.props.displayTabIcons&&(a.iconProps=void 0)}}i.AdminHubSplitterEnabledFeatureFlag="VisualStudio.Services.AdminEngagement.AdminHub.EnableSplitterLayout",i.AdminHubSettingsSearchEnabledFeatureId="ms.vss-admin-web.organization-admin-settings-search-feature",i.ContributedGroupKey="contributed",i.PivotParamName="adminPivot",l.Components.add("adminHub",i)}(),function(e){t.AdminHubMasterDetail={};class i extends l.VssComponent{constructor(e,t){super(e,t),this._name="",this._entityName="",this._selectedTabId=new a.ObservableValue(""),this._groups=[],this._contributionMap={},this._isSearchEnabled=!1,this._isSearching=new a.ObservableValue(!1),this._searchValue=new a.ObservableValue(""),this.textField=n.createRef(),this.onTextChanged=(e,t)=>{this._searchValue.value=t},this.onClickClearButton=e=>{this._searchValue.value="",this.textField.current&&this.textField.current.focus()},this.clearButtonIconProps={render:()=>this._searchValue.value?n.createElement(c.Button,{className:"bolt-text-filterbaritem-clear search-clear-button",iconProps:{iconName:"Cancel"},ariaLabel:T.CancelButton,onClick:this.onClickClearButton}):n.createElement("div",null)},this.SearchField=e=>{const t=n.useContext(C.MasterDetailsContext);return n.createElement("div",{className:"setting-search-textbox",role:"search"},n.createElement(g.TextField,{ariaLabel:T.SearchSettings,className:"bolt-text-filterbaritem flex-grow",inputClassName:"search-text-field-input",onChange:this.onTextChanged,width:"auto",onKeyDown:e=>{switch(e.which){case 13:this._isSearching.value=!0,t.setDetailsPanelVisbility(!0);break;case 27:this._isSearching.value=!1;break;default:return}e.preventDefault(),e.stopPropagation()},maxLength:50,placeholder:T.SearchSettings,ref:this.textField,style:1,suffixIconProps:this.clearButtonIconProps,value:this._searchValue,prefixIconProps:{className:"keyword-filter-icon",iconName:"Search"}}))},this.updatePage=e=>{const t=this._contributionMap[e];if(!t||!t.name)return;this.context.pageContext.getService("ITfsNavigationService").setPageTitle(`${T.Settings} · ${t.name}${this._entityName&&` (${this._entityName})`}`),this._breadcrumbService.setSelectedPivotBreadcrumb(a.ObservableLike.getValue(t.name),t.url&&a.ObservableLike.getValue(t.url))},this.renderSettingsItem=(e,t,a)=>{if(3===t.type)return n.createElement("tr",{className:"admin-tab-item-divider"});const i=n.createElement(P.Tooltip,{overflowOnly:!0},n.createElement("span",{className:`${2===t.type&&"title-xs"}`},t.name||t.text));let s=i;(t.iconProps||t.followingRegionName)&&(s=n.createElement(n.Fragment,null,t.iconProps&&n.createElement("span",{className:"flex-column"},(0,S.Icon)(Object.assign(Object.assign({},t.iconProps),{className:(0,f.css)("icon-margin",t.iconProps.className)}))),n.createElement("span",{className:"flex-column"},i),t.followingRegionName&&n.createElement(l.RegionComponent,{className:"flex-column",componentRegion:t.followingRegionName})));const r=2===t.type;return n.createElement(v.ListItem,{index:e,details:a,className:(0,f.css)("admin-tab-item",!r&&"admin-tab")},n.createElement("div",{className:(0,f.css)("bolt-tab-inner-container flex-row flex-grow admin-tab-text",r&&"admin-tab-header")},s))},this.settingsHubPayload=()=>({ariaLabel:this._name,key:"admin-hub",masterPanelContent:{renderContent:(e,t)=>n.createElement(this.AdminPanelContent,{selectedItem:t,listAriaLabel:this._name}),renderHeader:()=>{const e=n.createElement(P.Tooltip,{overflowOnly:!0},n.createElement("div",{className:"text-ellipsis"},this._entityName));return n.createElement(x.MasterPanelHeader,{title:this._name,subTitle:e,titleAriaLevel:2})},renderSearch:this._isSearchEnabled?()=>n.createElement(this.SearchField,null):void 0,hideBackButton:!0},detailsContent:{renderContent:e=>n.createElement(this.AdminHubDetailsView,{tab:e})},selectedMasterItem:new a.ObservableValue(this._contributionMap[this._selectedTabId.value]),parentItem:void 0}),this.AdminPanelContent=e=>{const[t]=n.useState(this._itemProvider),[a]=n.useState(new v.ListSelection({selectOnFocus:!1,unselectableRanges:this._itemProvider.value.reduce(((e,t,a)=>(!t.url&&e.push({beginIndex:a,endIndex:a}),e)),[])}));n.useEffect((()=>{(0,C.bindSelectionToObservable)(a,t,e.selectedItem)}));const i=(e,t)=>{const{url:a}=t.data;a&&t.data.onBeforeTabChange(e,"",a),e.preventDefault()};return n.createElement(v.List,{ariaLabel:e.listAriaLabel,itemProvider:t,selection:a,renderRow:this.renderSettingsItem,width:"100",onActivate:i,onSelect:i,virtualize:!1})},this.AdminHubDetailsView=e=>{const t=n.useContext(C.MasterDetailsContext),{tab:a}=e,i=n.createElement(n.Fragment,null,a.render&&a.render());return n.createElement(n.Fragment,null,n.createElement(I.ScreenSizeObserver,null,(e=>e.screenSize<=1&&n.createElement(c.Button,{className:"show-stack-btn",ariaLabel:T.ShowSideMenu,iconProps:{iconName:"Back",size:"medium"},onClick:()=>t.setDetailsPanelVisbility(!1)}))),n.createElement(d.Observer,{isSearching:this._isSearching},(e=>e.isSearching?n.createElement(l.WrappedComponent,{dependencies:["ms.vss-admin-web.settings-search-component"],wrappedType:"ms.vss-admin-web.setting-search-page",wrappedProps:{pageContext:this.context.pageContext,searchTerm:this._searchValue.value}}):n.createElement("div",{className:"flex-column flex-grow v-scroll-auto relative"},i))))};const{pageContext:i}=t,s="project"==e.level?i.getService("ITfsPageService"):i.getService("IVssPageService");switch(e.level){case"collection":{const e=s.getData();e&&(this._entityName=e.hostName,this._name=e.isHosted?T.AccountSettings:T.CollectionSettings)}break;case"project":{const e=s.getData();this._name=T.ProjectSettings,e&&e.project&&(this._entityName=e.project.name)}break;case"user":{const e=s.getData();this._name=T.UserSettings,e&&e.user&&(this._entityName=e.user.displayName)}}this._breadcrumbService=i.getService("admin-hub-header-breadcrumb-service"),this._selectedTabId.value=this.getCurrentTab(),this.initialize()}render(){return n.createElement(C.MasterDetailsContext.Provider,{value:this._masterDetailsContext},n.createElement("div",{className:"flex-row",style:{width:"100%"}},n.createElement(I.ScreenSizeObserver,null,(e=>{const t=e.screenSize<=1;return n.createElement(x.MasterPanel,{className:t?void 0:"admin-stackpanel"})})),n.createElement(x.DetailsPanel,{className:"admin-hub bolt-page v-scroll-auto flex-row"})))}componentDidMount(){super.componentDidMount(),this.updatePage(this._selectedTabId.value)}getCurrentTab(){return this.context.pageContext.getService("IVssNavigationService").getRouteValues()[i.PivotParamName]||this.props.defaultPivot||""}initialize(){const{pageContext:e}=this.context,{hubContributionDataProvider:t}=this.props,s=e.getService("IVssContributionService"),l=s.getContributionChildren(this.props.id,"ms.vss-web.tab-group")||[],c=[],d=()=>n.createElement("div",{className:"absolute-fill flex flex-column flex-center justify-center"},n.createElement(h.Spinner,{size:"large"}));if(this._groups=l.reduce(((t,a)=>{const n=(0,r.getTabs)(e,a,{routeStateKey:i.PivotParamName,fpsRequired:!0,preProcessTabContribution:e=>this.preProcessContributedTab(e,a)});c.push(...n.value.sort(((e,t)=>(e.order||1e3)-(t.order||1e3))));const o=s.getContribution(a);return o&&t.push({id:a,name:o.name,order:o.rank}),t}),[]),this._groups.push({id:i.ContributedGroupKey,name:T.Extensions,order:999}),t){const n=s.getData(t),o=new a.ObservableCollection;n&&o.push(n.contributions,(t=>(0,r.processTabContribution)(e,{routeStateKey:i.PivotParamName,fpsRequired:!0,loadingComponent:d,preProcessTabContribution:e=>{this.preProcessContributedTab(e,i.ContributedGroupKey)}},t.properties,t.id))),c.push(...o.value.sort(((e,t)=>(e.order||1e3)-(t.order||1e3))))}c.forEach((e=>{this._contributionMap[e.id]=e})),this._contributionMap[this._selectedTabId.value]||(this._selectedTabId.value=c[0].id),this._isSearchEnabled="collection"===this.props.level&&(0,o.isFeatureEnabled)(this.context.pageContext,i.AdminHubSettingsSearchEnabledFeatureId,!1),this._itemProvider=new E.GroupedItemProvider(c,this._groups.sort(((e,t)=>(e.order||1e3)-(t.order||1e3))),!0),this._masterDetailsContext=new C.BaseMasterDetailsContext(this.settingsHubPayload(),(()=>{}))}preProcessContributedTab(e,t){const a=e;!a.id&&a.itemKey&&(a.id=a.itemKey),a.groupId||(a.groupId=t),!0!==this.props.displayTabIcons&&(a.iconProps=void 0)}}i.AdminHubSettingsSearchEnabledFeatureId="ms.vss-admin-web.organization-admin-settings-search-feature",i.ContributedGroupKey="contributed",i.PivotParamName="adminPivot",l.Components.add("adminhub-masterdetail",i)}(),function(e){t.HighRiskSettingsIcon={};class a extends n.Component{render(){return(0,S.Icon)({className:"icon-margin high-risk-settings-icon",iconName:"ReportHacked"})}}l.Components.add("settings.highRiskSettingsIcon",a)}()}),["Resources","AdminHubBreadcrumbService","AdminHub","AdminHubMasterDetail","HighRiskSettingsIcon"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-admin-web.admin-hub-content"}}));