"use strict";define("TFS/Admin/Views/OrganizationOverview",["require","exports","TFS/Admin/Common/RestClient/Organization","TFS/Admin/Common/Constants/DataProviderConstants","VSS/Platform/Authentication","react","VSSUI/Button","VSSUI/MessageBar","VSS/Features/PersonaImages/VssAuthenticatedPersona","VSS/Platform/Identity","VSS/Core/Util/Promise","TFS/Admin/Common/Constants/TelemetryConstants","TFS/Admin/Common/Util/Telemetry/AdminTelemetry","VSS/Platform/Layout","VSS/Platform/Components/Format","VSSUI/Link","VSS/Platform/Feature","VSS/Core/Util/Accessibility","VSSUI/Dialog","VSSUI/TextField","VSS/Core/Observable","VSS/Core/Util/String","VSSUI/FormItem","TFS/Admin/Common/Util/NameValidator","VSSUI/Card","VSSUI/List","VSSUI/Table","VSSUI/Utilities/Provider","VSSUI/Spinner","VSSUI/Toggle","VSSUI/Dropdown","VSSUI/Utilities/DropdownSelection","VSSUI/Icon","TFS/Admin/Common/RestClient/HostAcquisition","VSSUI/Intersection","TFS/Admin/Common/Components/ResourceUsage"],(function(e,t,a,r,n,i,o,s,l,c,g,m,d,h,p,u,v,C,w,D,S,O,P,z,f,y,E,N,I,T,k,_,b,L,x,U){var j,M,R,A,F,V,B,Z,W,H;j=t[H="Resources"]={},t[H].ChangeOrganizationOwnerTitle="Change organization owner",t[H].SearchUsers="Search users",t[H].PlaceholderText="Enter name or email address",t[H].ChangeButton="Change",t[H].CancelButton="Cancel",t[H].SelectedUserErrorText="The selected user is not a member of this Azure DevOps organization.  Please add this user to {0} in the Organization Settings first.",t[H].AriaSelectNewOWner="Select New Owner",t[H].UpdateOwnerSuccess="Successfully updated organization owner",t[H].ChangeOwner="Change owner",t[H].SelectedUserNotFoundError="The selected user information could not be found.",t[H].SelectedGroupError="Groups are not supported as organization owners. Please select a user.",t[H].NewOwnerFetchError="Unable to fetch new owner data. Please refresh the page.",t[H].ChangeOwnerLearnMore="Learn more about the organization owner",t[H].ChangeOwnerLearnMoreLink="https://aka.ms/azure-devops-change-org-owner",t[H].SelectedSameUserError="The selected user is the current owner of this organization. Please select a different user.",t[H].TakeOverWarning="Warning: The owner and project collection administrator(s) for this organization are inactive in Microsoft Entra.",t[H].TakeOverLearnMore="Learn more",t[H].TakeOverLearnMoreLink="https://aka.ms/azure-devops-administrator-change-org-owner",t[H].DeleteOrganizationDialogTitle="Delete organization",t[H].DeleteOrganizationFirstParagraph='Are you sure you want to delete the "{0}" organization? All users in your organization will immediately lose access.',t[H].DeleteOrganizationSecondParagraph="You will have up to 28 days to recover this organization after which it will be permanently deleted.  This will result in the loss of all organization and related project artifacts. ",t[H].DeleteOrganizationConfirmationText='To confirm this action, please type "{0}".',t[H].DeleteOrganizationPlaceholderText="Type organization name",t[H].AgreementStatement="By clicking {0} you agree to the {1} and {2}.",t[H].DeleteOrganizationLateDeletionNote="{0} In rare cases, our deletion process might take up to 70 days due to backend retries and the need to delete data from multiple sources. ",t[H].BoldDelete="delete",t[H].BoldNote="Note:",t[H].TermsOfService="Terms of Service",t[H].TermsOfServiceLink="https://aka.ms/azure-legal",t[H].PrivacyStatement="Privacy Statement",t[H].PrivacyStatementLink="https://aka.ms/microsoft-privacy-statement",t[H].DeleteOrganizationDialogLearnMoreText="Learn more about restoring organizations",t[H].DeleteOrganizationDialogLearnMoreLink="https://aka.ms/azure-devops-recover-organization",t[H].DeleteOrganizationHeading="Delete organization",t[H].DeleteOrganizationNote="This will affect all contents and members of this organization. ",t[H].DeleteOrganizationLearnMoreText="Learn more about deleting organizations",t[H].DeleteOrganizationLearnMoreLink="https://aka.ms/azure-devops-delete-org",t[H].DeleteOrganizationButton="Delete",t[H].DeleteOrganizationRouteURL="https://aka.ms/azure-devops-website",t[H].SoftDeletedTitle="Recently deleted projects",t[H].SoftDeletedText="Restoring a deleted project will recover all project artifacts including work items, repos, teams, and builds. Projects that appear here will be permanently deleted after 28 days. ",t[H].SoftDeletedLearnMoreText="Learn more about deleting and restoring projects.",t[H].SoftDeletedLearnMoreLink="https://aka.ms/recover-project",t[H].SoftDeletedRestoreButton="Restore",t[H].SoftDeletedProjectDetails="",t[H].RestoreDialogTitle="Restore deleted project",t[H].RestoreDialogParagraph1='The project name "{0}" is no longer available. You can restore your project by choosing a different name.',t[H].RestoreDialogParagraph2="Current name: {0}",t[H].RestoreDialogPlaceholder="Project name",t[H].RestoreDialogCancel="Cancel",t[H].RestoreDialogConfirm="Confirm",t[H].RestoreDialogSameName="A project with this name already exists. Please select a new project name",t[H].RestoreProjectError="Error restoring project",t[H].InvalidProjectNameError='"{0}" is not a valid project name.',t[H].SeeMoreLink="See More",t[H].DeletedText="Deleted {0}",t[H].Name="Name",t[H].Icon="Icon",t[H].WaitError="There was an error while waiting for the operation to complete.",t[H].OrganizationOverviewHeading="Overview",t[H].CloseButton="Close",t[H].NameHeading="Name",t[H].DescriptionHeading="Description",t[H].OrganizationProfileImage="Organization profile image",t[H].PrivacyUrlLearnMore="Learn more about the Privacy URL",t[H].PrivacyUrlLearnMoreLink="https://aka.ms/azure-devops-privacy-url",t[H].DomainLearnMore="Learn more about URLs",t[H].DomainLearnMoreLink="https://aka.ms/new-domain",t[H].Visualstudio="{0}.visualstudio.com",t[H].SaveButton="Save",t[H].Region="Region",t[H].Geography="Geography",t[H].TimeZone="Time zone",t[H].PrivacyUrlHeading="Privacy URL",t[H].DescriptionPlaceholder="Add organization description",t[H].NewDomain="Use the new URL:  {0}",t[H].CurrentDomain="Current URL:  {0}",t[H].AriaOrganizationName="Organization name",t[H].AriaToggle="Enable new URL",t[H].AriaPrivacyURL="Organization Privacy URL",t[H].AriaDescription="Organization description",t[H].AriaTimeZone="Organization time zone",t[H].AreaRegion="Organization region",t[H].ChangesWarning="Changes made will affect all projects and members of the organization",t[H].RenameOrganizationDialogTitle="Change organization name",t[H].RenameOrganizationDialog1="Changing your organization name has several side effects. Please read the following before you proceed.",t[H].RenameOrganizationDialog2="Save all your work and ensure that nobody is using the service.\n\rThe existing organization URL {0} will not be redirected.\n\rWorkspaces and connection strings will need to be updated to point to the new URL. {1}",t[H].RenameOrganizationDialog2Link="https://aka.ms/azure-devops-rename-org",t[H].RenameOrganizationConfirmationText="I understand the consequences of renaming this organization.",t[H].RenameOrganizationNewName="Retype new organization name",t[H].InvalidOrganizationNameMessage='"{0}" is not a valid organization name.',t[H].OrganizationOwner="Organization owner",t[H].FailedUpdate="Failure to update organization",t[H].FailedMigration="Migrate domain failure",t[H].ChangeOrganizationDomain="Change organization domain",t[H].Cancel="Cancel",t[H].TenantId="Tenant Id: {0}",t[H].ChangeOrganizationText="This change will affect all users in your organization. Links from many email and web-based links will change. Do you confirm this change?",t[H].UpdateDetailsSuccess="Successfully updated organization details",t[H].UpdateToggleSuccess="Successfully updated domain URL",t[H].NameIsNotAvailable="{0} is not available.  Please choose another.",t[H].DataProviderError="We are unable to load overview settings at this time.  Please try again later.",t[H].GeographyLearnMore="Learn more about the Geographies",t[H].GeographyLearnMoreLink="https://aka.ms/azure-devops-org-location",t[H].ChangeImageClick="Click to change image.",t[H].ChangeImageTitle="Organization image",function(e){M=t[e]={},function(e){e.DelayLoadDataProviderId="ms.vss-admin-web.organization-admin-overview-delay-load-data-provider",e.EditDataProviderId="ms.vss-admin-web.organization-admin-overview-data-provider",e.DeleteTokenDataProviderId="ms.vss-admin-web.organization-admin-overview-token-data-provider"}(t[e].OrganizationDataProvidersContributions||(t[e].OrganizationDataProvidersContributions={})),function(e){e.ServiceInstanceTypeAex="00000041-0000-8888-8000-000000000000"}(t[e].OrganizationServiceInstanceTypes||(t[e].OrganizationServiceInstanceTypes={})),function(e){e.ProgressPollInterval=500}(t[e].ConstantNumbers||(t[e].ConstantNumbers={})),function(e){e.EditableOrganizationAvatar="VisualStudio.Services.AdminEngagement.OrganizationOverview.EditableOrganizationAvatar"}(t[e].FeatureConstants||(t[e].FeatureConstants={}))}("ConstantsConstants"),t.ContractsDataModels={},function(e){R=t[e]={};t[e].OrganizationOverviewSource=class{renameCollection(e,t){return this.getCollectionClient(t).updateCollection((()=>{let t=[];return t.push({from:"",op:2,path:r.DataProviders.NamePath,value:e}),t})(),r.DataProviders.Me)}deleteCollection(e,t,r){return(0,a.getOrganizationClient)(t,{hostType:2,authTokenProvider:r?new n.BearerTokenProvider(r.token):null}).deleteCollection(e)}forceUpdateCollectionOwner(e,t,r,n){return(0,a.getOrganizationClient)(r).forceUpdateCollectionOwner(e,t,n)}queueChangeDomain(e,t){return t.pageContext.getRestClient("INewDomainUrlOrchestrationRestClient").queueMigration(e)}async waitChangeDomainCompletion(e){let t=e.pageContext.getRestClient("INewDomainUrlOrchestrationRestClient");for(;;){let e;try{if(e=await t.getStatus(),e){if(3==e.status||0==e.status)return!0;if(4==e.status)return!1}}catch(e){console.error(e)}await this.sleep(1e3)}}async sleep(e){return new Promise((t=>setTimeout(t,e)))}updateCollectionOwner(e,t){return(0,a.getOrganizationClient)(t).updateCollection((()=>{let t=[];return t.push({from:"",op:2,path:r.DataProviders.OwnerPath,value:e}),t})(),r.DataProviders.Me)}updateProperties(e,t,a,n,i){return this.getCollectionClient(t).updateCollectionProperties(e,(()=>{let e=[];return null!==a&&e.push({from:"",op:2,path:r.DataProviders.DescriptionPath,value:a}),n&&e.push({from:"",op:2,path:r.DataProviders.TimeZonePath,value:JSON.stringify(n.trim())}),null!==i&&e.push({from:"",op:2,path:r.DataProviders.PrivacyUrlPath,value:i}),e})())}getCollectionClient(e){return(0,a.getOrganizationClient)(e.pageContext)}}}("SourcesOrganizationOverviewSources"),function(e){A=t[e]={};class a extends i.Component{constructor(e){super(e),this.telemetryLogger=new d.AdminTelemetry(this.props.pageContext),this._startActionCapture=(e,t)=>this.telemetryLogger.startActionCapture(m.Feature.OrganizationOverview,m.Feature.OrganizationOverview,e,t),this._onOwnerSelected=e=>{var t={hasError:!0,enableActionButton:!1};return e?e.localId?"User"!=e.entityType?(t.errorComponent=i.createElement("div",null,j.SelectedGroupError),t):e.localId===this.props.owner.id?(t.errorComponent=i.createElement("div",null,j.SelectedSameUserError),t):{hasError:!1,enableActionButton:!0}:(t.errorComponent=i.createElement(p.FormatComponent,{format:j.SelectedUserErrorText},this.props.organizationName),t):(t.errorComponent=i.createElement("div",null,j.SelectedUserNotFoundError),t)},this._onChangeOwner=async(e,t)=>{this.setState({updateInProgress:!0});var a=new R.OrganizationOverviewSource;if(e&&e.localId){var r;if(this.state.isTakeOver){var n=this._startActionCapture("Take Over Organization",{});r=a.forceUpdateCollectionOwner(t||"Not included",this.props.organizationId,this.props.pageContext,e.localId)}else{n=this._startActionCapture("Update Organization Owner",{UpdatedByCurrentOwner:this.props.isOwner?"true":"false"});r=a.updateCollectionOwner(e.localId,this.props.pageContext)}r.then((async e=>{e.name===this.props.organizationName&&await this._refreshPageDataForOwnerChange()}),(e=>{(0,C.announce)(e.message),this.setState({updateInProgress:!1,error:e.message||String(e),showChangeOwnerPanel:!1}),n.captureError(e.message)}))}},this._onCancelChangeOwner=()=>{this.setState({showChangeOwnerPanel:!1,isTakeOver:!1})},this._onChangeOwnerClick=async e=>{this._startActionCapture("Show change owner panel",{}),this.setState({showChangeOwnerPanel:!0})},this._onTakeOverClick=async e=>{this._startActionCapture("Show change owner panel for takeover",{}),this.setState({showChangeOwnerPanel:!0,isTakeOver:!0})},this.state={showChangeOwnerPanel:!1,updateInProgress:!1,showTakeOverMessage:!!this.props.organizationTakeover&&(this.props.organizationTakeover.isEligibleForTakeOver&&(0,v.isFeatureFlagEnabled)(this.props.pageContext,"VisualStudio.Services.AdminEngagement.OrganizationOverview.EnableTakeOverUI",!1)),isTakeOver:!1}}render(){return this.imageUrl=this._getOwnerImage(),i.createElement("div",null,i.createElement("div",null,this.state.error?i.createElement(s.MessageBar,{className:"organization-message",severity:"Error",onDismiss:()=>this.setState({error:void 0})},this.state.error):null,this.state.success?i.createElement(s.MessageBar,{className:"organization-message",severity:"Success",onDismiss:()=>this.setState({success:void 0})},this.state.success):null,this.props.organizationTakeover&&this.props.organizationTakeover.isEligibleForTakeOver&&this.state.showTakeOverMessage?i.createElement(s.MessageBar,{className:"organization-message",severity:"Warning",onDismiss:()=>this.setState({showTakeOverMessage:!1}),buttonProps:[{text:j.ChangeOwner,onClick:this._onTakeOverClick,disabled:!this.props.organizationTakeover.isAzureDevOpsAdministrator}]},i.createElement("div",{className:"flex-column word-break"},j.TakeOverWarning,i.createElement(u.Link,{target:"_blank",rel:"noopener noreferrer",href:j.TakeOverLearnMoreLink},j.TakeOverLearnMore))):null,i.createElement("div",{className:"title-m"},j.OrganizationOwner),i.createElement("div",{className:"flex-row flex-center organization-owner"},i.createElement(l.VssAuthenticatedPersona,{identityDetailsProvider:{getIdentityImageUrl:e=>this.imageUrl,getDisplayName:()=>this.props.owner.name}}),i.createElement("div",{className:"organization-owner-details"},i.createElement("div",{className:"fontWeightSemiBold"},this.props.owner.name),i.createElement("div",null,this.props.owner.email))),i.createElement("div",{className:"learn-more-link"},i.createElement(u.Link,{target:"_blank",rel:"noopener noreferrer",href:j.ChangeOwnerLearnMoreLink},j.ChangeOwnerLearnMore)),i.createElement("div",{className:"change-owner"},i.createElement(o.Button,{disabled:this.state.updateInProgress||!this.props.hasModifyPermissions,onClick:this._onChangeOwnerClick},j.ChangeOwner)),i.createElement("div",{className:"overview-divider"})),this.state.showChangeOwnerPanel?i.createElement(h.WrappedComponent,{dependencies:["ms.vss-admin-web.admin-common"],wrappedType:"ms.vss-admin-web.select-user-panel",wrappedProps:{pageContext:this.props.pageContext,onCancel:this._onCancelChangeOwner,onSelectUser:this._onChangeOwner,panelTitle:j.ChangeOrganizationOwnerTitle,actionButtonText:j.ChangeButton,identityTypesToLookup:["user","group"],onUserChange:this._onOwnerSelected,selectUserPlaceHolderText:j.SearchUsers,selectUserEditPlaceHolderText:j.SearchUsers,requestReason:this.state.isTakeOver}}):null)}async _refreshPageDataForOwnerChange(){const e=this.props.pageContext.getService("IVssContributionService");var t=this._startActionCapture("Fetching new data after change owner",{});try{let t=0;for(;!0===this.state.updateInProgress&&t++<100;){var a=await e.getDataAsync(M.OrganizationDataProvidersContributions.DelayLoadDataProviderId,void 0,!0);a&&this.props.owner.id!==a.currentOwner.id&&(this.imageUrl=void 0,(0,C.announce)(j.UpdateOwnerSuccess),this.setState({updateInProgress:!1,showChangeOwnerPanel:!1,success:j.UpdateOwnerSuccess,showTakeOverMessage:!1}),this.props.onChangeOwner(a.currentOwner)),await(0,g.wait)(M.ConstantNumbers.ProgressPollInterval)}}catch(e){t.captureError(e.message),(0,C.announce)(j.NewOwnerFetchError),this.setState({updateInProgress:!1,showChangeOwnerPanel:!1,error:j.NewOwnerFetchError})}}_getOwnerImage(){return(0,c.getIdentityImageUrl)(this.props.pageContext,this.props.owner.id)}}t[e].ChangeOwner=a}("ComponentsChangeOwnerChangeOwner"),function(e){F=t[e]={};class a extends i.Component{constructor(e){super(e),this.organizationName=new S.ObservableValue(""),this._onNameChanged=(e,t)=>{this.organizationName.value=t,this._validateorganizationName(t)},this._onKeyPress=e=>{13===e.which&&this.state.isMatch&&this.props.onDeleteOrganization()},this._validateorganizationName=e=>{0===(0,O.localeIgnoreCaseComparer)(e,this.props.organizationName)?this.setState({isMatch:!0}):this.setState({isMatch:!1})},this.state={isMatch:!1},this._onNameChanged=this._onNameChanged.bind(this)}render(){return i.createElement(w.Dialog,{onDismiss:()=>{this.props.onCancel()},contentSize:2,className:"delete-organization-dialog",titleProps:{text:j.DeleteOrganizationDialogTitle,className:"fontWeightSemiBold"},footerButtonProps:[{text:j.Cancel,onClick:()=>{this.props.onCancel()}},{className:"delete-organization-button",danger:!0,disabled:!this.state.isMatch,onClick:()=>this.props.onDeleteOrganization(),text:j.DeleteOrganizationButton}]},i.createElement("div",{className:"delete-organization-dialog-content flex-column"},i.createElement("div",{className:"delete-organization-first-paragraph"},i.createElement(p.FormatComponent,{format:j.DeleteOrganizationFirstParagraph},i.createElement("span",{className:"delete-organization-name fontWeightSemiBold"},this.props.organizationName))),i.createElement("div",{className:"delete-organization-second-paragraph"},j.DeleteOrganizationSecondParagraph,i.createElement(u.Link,{className:"learn-more-link",href:j.DeleteOrganizationDialogLearnMoreLink,target:"_blank",rel:"noopener noreferrer"},j.DeleteOrganizationDialogLearnMoreText)),i.createElement("div",{className:"delete-organization-action-paragraph"},i.createElement(p.FormatComponent,{format:j.DeleteOrganizationConfirmationText},i.createElement("span",{className:"delete-organization-name fontWeightSemiBold"},this.props.organizationName))),i.createElement(D.TextField,{className:"delete-button-text-field",placeholder:j.DeleteOrganizationPlaceholderText,value:this.organizationName,ariaLabel:j.DeleteOrganizationPlaceholderText,onKeyDown:this._onKeyPress,onChange:this._onNameChanged}),i.createElement("div",{className:"top-margin"},i.createElement(p.FormatComponent,{format:j.AgreementStatement},i.createElement("span",{className:"fontWeightSemiBold"},j.BoldDelete),i.createElement(u.Link,{href:j.TermsOfServiceLink,target:"_blank",rel:"noopener noreferrer"},j.TermsOfService),i.createElement(u.Link,{href:j.PrivacyStatementLink,target:"_blank",rel:"noopener noreferrer"},j.PrivacyStatement))),i.createElement("div",{className:"top-margin"},i.createElement(p.FormatComponent,{format:j.DeleteOrganizationLateDeletionNote},i.createElement("span",{className:"fontWeightSemiBold"},j.BoldNote)))))}}t[e].DeleteOrganizationDialog=a}("ComponentsDeleteOrganizationDeleteOrganizationDialog"),function(e){V=t[e]={};class a extends i.Component{constructor(e){super(e),this.telemetryLogger=new d.AdminTelemetry(this.props.pageContext),this._startActionCapture=(e,t)=>this.telemetryLogger.startActionCapture(m.Feature.OrganizationOverview,m.Feature.OrganizationOverview,e,t),this._onDeleteOrganizationClick=e=>{this._startActionCapture("Show delete organization dialog",{}),this.setState({showDeleteOrganizationDialog:!0})},this._onDeleteOrganization=async()=>{this.setState({showDeleteOrganizationDialog:!1,updateInProgress:!0});var e=this._startActionCapture("Delete Organization",{});const t=this.props.pageContext.getService("IVssContributionService");let a=await t.getDataAsync(M.OrganizationDataProvidersContributions.DeleteTokenDataProviderId);var r=new R.OrganizationOverviewSource;await r.deleteCollection(this.props.organizationId,this.props.pageContext,a?a.enterpriseLevelSessionToken:void 0).then((t=>{t?(this.setState({updateInProgress:!1}),window.location.href=j.DeleteOrganizationRouteURL):(e.captureError("No result returned from deleteCollection"),this.setState({updateInProgress:!1}))}),(t=>{e.captureError(t.message),(0,C.announce)(t.message),this.setState({updateInProgress:!1,error:t.message})}))},this._onCancelDelete=()=>{this.setState({showDeleteOrganizationDialog:!1})},this.state={updateInProgress:!1}}render(){return i.createElement("div",null,i.createElement("div",{className:"delete-organization"},this.state.error?i.createElement(s.MessageBar,{className:"organization-message",severity:"Error",onDismiss:()=>this.setState({error:void 0})},this.state.error):null,i.createElement("div",{className:"title-m service-title"},j.DeleteOrganizationHeading),i.createElement("div",{className:"note"},j.DeleteOrganizationNote),i.createElement("div",null,i.createElement(u.Link,{className:"learn-more-link",href:j.DeleteOrganizationLearnMoreLink,target:"_blank",rel:"noopener noreferrer","aria-label":j.DeleteOrganizationLearnMoreText},j.DeleteOrganizationLearnMoreText)),i.createElement(o.Button,{className:"delete-organization-button top-margin",disabled:this.state.updateInProgress,onClick:this._onDeleteOrganizationClick,danger:!0},j.DeleteOrganizationButton),i.createElement("div",{className:"overview-divider"})),this.state.showDeleteOrganizationDialog?i.createElement(F.DeleteOrganizationDialog,{pageContext:this.context.pageContext,organizationName:this.props.organizationName,onCancel:this._onCancelDelete,onDeleteOrganization:this._onDeleteOrganization}):null)}}t[e].DeleteOrganization=a}("ComponentsDeleteOrganizationDeleteOrganization"),function(e){B=t[e]={};class a extends i.Component{constructor(e){super(e),this.projectName=new S.ObservableValue(""),this.errorMessage=new S.ObservableValue(""),this._onNameChanged=(e,t)=>{this.projectName.value=t,t?0===(0,O.localeIgnoreCaseComparer)(t,this.props.projectName)||this.props.secondProjectName&&0===(0,O.localeIgnoreCaseComparer)(t,this.props.secondProjectName)?(this.errorMessage.value=j.RestoreDialogSameName,this.setState({isValid:!1})):(0,z.validateProjectName)(t)?(this.errorMessage.value="",this.setState({isValid:!0})):(this.errorMessage.value=(0,O.format)(j.InvalidProjectNameError,this.projectName.value),this.setState({isValid:!1})):(this.errorMessage.value="",this.setState({isValid:!1}))},this.state={isValid:!1}}render(){return this.displayName=this.props.secondProjectName?this.props.secondProjectName:this.props.projectName,i.createElement(w.Dialog,{onDismiss:()=>{this.props.onCancel()},contentSize:2,className:"restore-project-dialog",titleProps:{text:j.RestoreDialogTitle,className:"fontWeightSemiBold"},footerButtonProps:[{text:j.Cancel,onClick:()=>{this.props.onCancel()}},{disabled:!this.state.isValid,text:j.RestoreDialogConfirm,onClick:()=>this.props.onRestoreProject(this.props.projectId,this.projectName.value),className:"restore-project-button",primary:!0}]},i.createElement("div",{className:"flex-column restore-project-dialog-content"},i.createElement("div",null,i.createElement("div",{className:"restore-project-first-paragraph"},i.createElement(p.FormatComponent,{format:j.RestoreDialogParagraph1},i.createElement("span",{className:"restore-project-name fontWeightSemiBold"},this.displayName))),this.props.secondProjectName?i.createElement("div",null,i.createElement("div",{className:"restore-project-second-paragraph top-margin"},i.createElement(p.FormatComponent,{format:j.RestoreDialogParagraph2},i.createElement("span",{className:"restore-project-name fontWeightSemiBold"},this.props.projectName)))):i.createElement("div",{className:"restore-project-second-paragraph top-margin"}),i.createElement(P.FormItem,{className:"restore-button-text-field top-margin",message:this.errorMessage.value,error:""!==this.errorMessage.value},i.createElement(D.TextField,{value:this.projectName,onChange:this._onNameChanged,placeholder:j.RestoreDialogPlaceholder,ariaLabel:j.RestoreDialogPlaceholder})))))}}t[e].RestoreProjectDialog=a}("ComponentsSoftDeletedProjectsRestoreDialog"),function(e){Z=t[e]={};class a extends i.Component{constructor(e){super(e),this.locationColumns=[{id:"icon",name:j.Icon,width:58,renderCell:this.renderIcon},{id:"name",name:j.Name,width:-100,renderCell:this.renderName}],this.state={selectedProject:new y.ListSelection(!1)}}render(){return i.createElement(f.Card,{className:"restore-project-table",contentProps:{contentPadding:!1}},i.createElement(E.Table,{columns:this.locationColumns,itemProvider:new N.ArrayItemProvider(this.props.softDeletedProjects),singleClickActivation:!0,selection:this.state.selectedProject,onSelect:(e,t)=>{this.props.OnSelectedProject(this.props.softDeletedProjects[t.index]),this.state.selectedProject.selected(t.index)},showHeader:!1,scrollable:!0}))}componentDidUpdate(){!this.props.selectedProject&&this.state.selectedProject.selectedCount>0&&this.state.selectedProject.clear()}renderIcon(e,t,a,r){return i.createElement(E.SimpleTableCell,{key:"row"+e+"col"+t,columnIndex:t,tableColumn:a},i.createElement(l.VssAuthenticatedPersona,{identityDetailsProvider:{getIdentityImageUrl:e=>r.defaultTeamImageUrl,getDisplayName:()=>r.name},size:"medium",cssClass:"soft-deleted-persona"}))}renderName(e,t,a,r){return i.createElement(E.TwoLineTableCell,{key:"row"+e+"col-"+t,columnIndex:t,tableColumn:a,line1:i.createElement("span",{className:"fontWeightSemiBold fontSizeMM"},r.name),line2:i.createElement("span",null,(n=r.lastUpdateTime,(0,O.format)(j.DeletedText,n.toLocaleDateString(void 0,{day:"2-digit",month:"2-digit",year:"numeric"}))))});var n}}t[e].RestoreTable=a}("ComponentsSoftDeletedProjectsRestoreTable"),function(e){W=t[e]={};class a extends i.Component{constructor(e){super(e),this.telemetryLogger=new d.AdminTelemetry(this.props.pageContext),this.countToQuery=10,this._getDeletedProjects=()=>{const e=this.props.pageContext.getRestClient("ICoreRestClient"),t=this._startActionCapture("Fetch deleted projects",{});e.getProjects(4,this.countToQuery+1,void 0,void 0,!0).then((e=>{if(e&&e.length>0){let t=!1;e.length>this.countToQuery&&(e=e.splice(0,e.length-1),t=!0),this.setState({softDeletedProjects:e,hasMoreDeletedProjects:t})}else this.setState({softDeletedProjects:void 0})})).catch((e=>{t.captureError(e.errorMessage)}))},this._seeMore=()=>{this.countToQuery+=10,this._getDeletedProjects()},this._startActionCapture=(e,t)=>this.telemetryLogger.startActionCapture(m.Feature.OrganizationOverview,m.Feature.OrganizationOverview,e,t),this._onRestoreClick=()=>{this._startActionCapture("Restore Project Clicked",{}),this.setState({updateInProgress:!0});const e=this.state.selectedProject?this.state.selectedProject.id:"",t={state:1};this._updateProject(t,e)},this._onSelectedProject=e=>{this.setState({selectedProject:e,enableRestore:!0})},this._onCancel=()=>{this.setState({showRestoreDialog:!1,newProjectName:void 0})},this._onProjectRestore=(e,t)=>{this._startActionCapture("Restore Project from Dialog",{}),this.setState({showRestoreDialog:!1,updateInProgress:!0,newProjectName:t});const a={state:1,name:t};this._updateProject(a,e)},this._monitorProgress=async e=>{if(1e3>e&&this._operationId){const t=this.props.pageContext.getRestClient("IOperationsRestClient");let a=!1;try{const e=await t.getOperation(this._operationId);switch(e.status){case 4:a=!0;break;case 3:case 5:a=!0,this.setState({error:e.resultMessage})}}catch(e){this.setState({error:j.RestoreProjectError,updateInProgress:!1})}a?this._operationId=null:(await(0,g.wait)(500),await this._monitorProgress(e+1))}},this.state={showRestoreDialog:!1,enableRestore:!1,hasMoreDeletedProjects:!1},this._getDeletedProjects()}render(){return i.createElement("div",null,this.state.softDeletedProjects?i.createElement("div",null,this.state.error?i.createElement(s.MessageBar,{severity:"Error",onDismiss:()=>this.setState({error:void 0})},this.state.error):null,i.createElement("div",{className:"soft-deleted-section flex-column"},i.createElement("div",{className:"title-m"},j.SoftDeletedTitle),i.createElement("div",{className:"note top-margin soft-deleted-text"},j.SoftDeletedText,i.createElement(u.Link,{className:"learn-more-link",href:j.SoftDeletedLearnMoreLink,target:"_blank",rel:"noopener noreferrer"},j.SoftDeletedLearnMoreText)),i.createElement("div",null,i.createElement(Z.RestoreTable,{softDeletedProjects:this.state.softDeletedProjects,OnSelectedProject:this._onSelectedProject,selectedProject:this.state.selectedProject})),this.state.hasMoreDeletedProjects?i.createElement("div",null,i.createElement(u.Link,{className:"top-margin see-more-link",onClick:this._seeMore},j.SeeMoreLink)):null,i.createElement("div",null,i.createElement(o.Button,{className:"top-margin",onClick:this._onRestoreClick,disabled:!this.state.enableRestore||this.state.updateInProgress},j.SoftDeletedRestoreButton)),i.createElement("div",{className:"overview-divider"})),this.state.showRestoreDialog?i.createElement(B.RestoreProjectDialog,{pageContext:this.props.pageContext,projectId:this.state.selectedProject?this.state.selectedProject.id:"",projectName:this.state.selectedProject?this.state.selectedProject.name:"",onCancel:this._onCancel,onRestoreProject:this._onProjectRestore,secondProjectName:this.state.newProjectName}):null,this.state.updateInProgress?i.createElement(I.Spinner,{size:"large"}):null):null)}_updateProject(e,t){const a=this.props.pageContext.getRestClient("ICoreRestClient"),r=this._startActionCapture("Restore Project",{});a.updateProject(e,t).then((async e=>{this._operationId=e.id,await this._monitorProgress(0),this._getDeletedProjects(),this.setState({updateInProgress:!1,newProjectName:void 0,selectedProject:void 0,enableRestore:!1})})).catch((e=>{if(e.message.indexOf("TF200019")>=0){const e=this._startActionCapture("Show Restore Project Dialog",{});this.state.selectedProject&&""!==this.state.selectedProject.id&&""!==this.state.selectedProject.name?this.setState({showRestoreDialog:!0,updateInProgress:!1}):(this.setState({updateInProgress:!1,error:j.RestoreProjectError,newProjectName:void 0}),e.captureError("Restore Project Failure with matching name error but no name state"))}else this.setState({updateInProgress:!1,error:e.message,newProjectName:void 0}),r.captureError(e.message)}))}}t[e].SoftDeletedProjects=a}("ComponentsSoftDeletedProjectsSoftDeletedProjects"),function(e){t[e]={};class r extends h.VssComponent{constructor(e,t){super(e,t),this.telemetryLogger=new d.AdminTelemetry(this.context.pageContext),this.dataProviderError=j.DataProviderError,this._timeZoneSelection=new _.DropdownSelection,this._cancelImageUpload=e=>{this.setState({showChangeImageDialog:!1})},this._saveImageAction=(e,t)=>{e?this._removeImage():this._saveImage(t)},this._onChangeImageClick=()=>{this.setState({showChangeImageDialog:!0})},this._onChangeImageKeyDown=e=>{13!==e.keyCode&&32!==e.keyCode||this._onChangeImageClick()},this._startActionCapture=(e,t)=>this.telemetryLogger.startActionCapture(m.Feature.OrganizationOverview,m.Feature.OrganizationOverview,e,t),this._onCancelToggle=e=>{this.setState({showMigrationDialog:!1,domainToggle:!this.state.domainToggle})},this.onComboChanged=(e,t)=>{t&&this.setState({timeZone:{id:t.id,displayName:t.text?t.text:""}})},this._onChange=(e,t)=>{e.value=t,this.isEdited===this._checkChangeState()&&this.errorMessage===this._getNameErrorMessage()||this.forceUpdate()},this._onToggelChange=async(e,t)=>{this._startActionCapture("Show migration dialog",{}),this.setState({domainToggle:t}),this.setState({showMigrationDialog:!0})},this._saveMigration=async()=>{var e=new R.OrganizationOverviewSource,t=this._startActionCapture("Migrate Domain",{CodexDomain:this.state.domainToggle});this.setState({updateInProgress:!0,showMigrationDialog:!1}),e.queueChangeDomain(this.state.domainToggle,this.context).then((async()=>{t.captureTelemetry({Info:"Wait for domain migration"}),await this._waitForDomainMigrationComplete(e,t)}),(e=>{this.setState({updateInProgress:!1,error:e.message||String(e),domainToggle:this.state.delayLoadData?this.state.delayLoadData.devOpsDomainUrls:!this.state.domainToggle}),(0,C.announce)(e.message),t.captureError(e.message)}))},this._checkChangeState=()=>!(0===(0,O.localeIgnoreCaseComparer)(this.name.value,this.state.data.name)&&this.description.value===this.state.data.description&&this.privacyUrl.value===this.state.data.privacyUrl&&this.state.timeZone.id===this.state.data.timeZone.id||""===this.name.value||!(0,z.validateOrganizationName)(this.name.value)),this._onRename=e=>{this.setState({showRenameDialog:!1}),this._saveOrganizationDetails(!0,e)},this._onSaveClick=e=>{var t=this._startActionCapture("Save clicked",{});0!==(0,O.localeIgnoreCaseComparer)(this.name.value,this.state.data.name)?(this.setState({updateInProgress:!0}),this._isNameAvailable(this.name.value).then((e=>{e?this._triggerSaveDialog():(t.captureError("Organization Name taken"),(0,C.announce)((0,O.format)(j.NameIsNotAvailable,this.name.value)),this.setState({updateInProgress:!1,error:(0,O.format)(j.NameIsNotAvailable,this.name.value)}))})).catch((e=>{t.captureError(e.message),this._triggerSaveDialog()}))):this._saveOrganizationDetails(!1)},this._getNameErrorMessage=()=>""===this.name.value||(0,z.validateOrganizationName)(this.name.value)?"":(0,O.format)(j.InvalidOrganizationNameMessage,this.name.value),this._isNameAvailable=async e=>{const t=this.context.pageContext.getService("IVssContributionService");let a=await t.getDataAsync(M.OrganizationDataProvidersContributions.DeleteTokenDataProviderId);var r=(0,L.getHostAcquisitionClient)(this.context.pageContext,{hostType:1,serviceInstanceType:M.OrganizationServiceInstanceTypes.ServiceInstanceTypeAex,authTokenProvider:a&&a.deploymentLevelSessionToken?new n.BearerTokenProvider(a.deploymentLevelSessionToken.token):void 0});return(await r.getNameAvailability(e)).isAvailable},this._saveOrganizationDetails=async(e,t)=>{var a=!1;if(this.description.value!==this.state.data.description&&(this._startActionCapture("Update Description",{}),a=!0),this.state.timeZone.id!==this.state.data.timeZone.id&&(this._startActionCapture("Update Time Zone",{}),a=!0),this.privacyUrl.value!==this.state.data.privacyUrl&&(this._startActionCapture("Update Privacy Url",{}),a=!0),a){this.setState({updateInProgress:!0});var r=new R.OrganizationOverviewSource,n=this._startActionCapture("Update Organization",{});await r.updateProperties(this.state.data.id,this.context,this.description.value,this.state.timeZone.id,this.privacyUrl.value).then((e=>{e?this._refreshProperties():(n.captureError("No result returned from updateProperties"),this.setState({updateInProgress:!1}))}),(e=>{n.captureError(e.message),(0,C.announce)(e.message),this.setState({updateInProgress:!1,error:e.message})}))}if(e&&t){n=this._startActionCapture("Rename Organization",{});this.setState({updateInProgress:!0});r=new R.OrganizationOverviewSource;await r.renameCollection(t,this.context).then((async e=>{e.name!==this.state.data.name&&this._refreshPageForRename(t)}),(e=>{this.setState({updateInProgress:!1,error:e.message||String(e)}),(0,C.announce)(e.message),n.captureError(e.message)}))}},this._changeUrl=(e,t)=>{let a=window.location.href;a=a.replace(e,t),window.location.href=a,this.setState({updateInProgress:!1})};const a=this.context.pageContext.getService("IVssContributionService");this.state={data:a.getData(M.OrganizationDataProvidersContributions.EditDataProviderId),domainToggle:!1,timeZone:{id:"",displayName:""}},this.state.data&&(this.privacyUrl=new S.ObservableValue(this.state.data.privacyUrl),this.name=new S.ObservableValue(this.state.data.name),this.description=new S.ObservableValue(this.state.data.description),this.avatarUrl=this.state.data.avatarUrl,this.state.timeZone.id=this.state.data.timeZone.id,this.state.timeZone.displayName=this.state.data.timeZone.displayName,this.options=this._getOptions(!1)),this._timeZoneSelection.select(0)}render(){const e=this.state.data;if(!e)return i.createElement("div",{className:"overview-content"},i.createElement(s.MessageBar,{className:"organization-message top-margin overview-content",severity:"Error"},this.dataProviderError));this.errorMessage=this._getNameErrorMessage(),this._onChangeOwner=this._onChangeOwner.bind(this);const t=this.state.delayLoadData,a=e=>i.createElement("h5",{className:"fontSizeM overview-heading"},e);return this.isEdited=this._checkChangeState(),this.options.length<=1&&this.state.delayLoadData&&(this.options=this._getOptions(!0)),i.createElement(x.Intersection,null,i.createElement("div",{className:"overview-content"},i.createElement("div",{className:"title-l"},j.OrganizationOverviewHeading),this.state.error?i.createElement(s.MessageBar,{className:"organization-message",severity:"Error",onDismiss:()=>this.setState({error:void 0})},this.state.error):null,this.state.success?i.createElement(s.MessageBar,{className:"organization-message",severity:"Success",onDismiss:()=>this.setState({success:void 0})},this.state.success):null,i.createElement("div",{className:"organization-overview flex-row"},i.createElement("div",{className:"overview-edit-fields"},i.createElement("div",{className:"organization-name flex-row"},i.createElement("div",{className:"flex-column"},a(j.NameHeading),i.createElement(P.FormItem,{className:"organization-name-field",message:this.errorMessage,error:""!==this.errorMessage},i.createElement(D.TextField,{value:this.name,onChange:(e,t)=>this._onChange(this.name,t),ariaLabel:j.AriaOrganizationName,disabled:!e.hasModifyPermissions})),i.createElement("div",{className:"organization-new-domain flex-row flex-center"},this.state.delayLoadData&&this.state.delayLoadData.showDomainMigration?i.createElement("div",null,i.createElement(T.Toggle,{ariaLabel:j.AriaToggle,checked:this.state.domainToggle,onChange:(e,t)=>this._onToggelChange(e,t),disabled:!e.hasModifyPermissions||this.state.updateInProgress||this.state.delayLoadData.disableDomainMigration}),i.createElement(p.FormatComponent,{format:j.NewDomain,className:"organization-url"},this.state.delayLoadData.devOpsDomainUrls?e.url:this.state.delayLoadData.targetDomainUrl)):i.createElement(p.FormatComponent,{format:j.CurrentDomain},e.url)),i.createElement(u.Link,{target:"_blank",rel:"noopener noreferrer",href:j.DomainLearnMoreLink},j.DomainLearnMore)),(0,v.isFeatureFlagEnabled)(this.context.pageContext,M.FeatureConstants.EditableOrganizationAvatar,!1)?this.getNewOrganizationImage():this.getOldOrganizationImage()),a(j.PrivacyUrlHeading),i.createElement(D.TextField,{ariaLabel:j.AriaPrivacyURL,className:"organization-privacy-url-field",value:this.privacyUrl,multiline:!1,onChange:(e,t)=>this._onChange(this.privacyUrl,t),disabled:!e.hasModifyPermissions}),i.createElement(u.Link,{target:"_blank",rel:"noopener noreferrer",href:j.PrivacyUrlLearnMoreLink},j.PrivacyUrlLearnMore),a(j.DescriptionHeading),i.createElement(D.TextField,{ariaLabel:j.AriaDescription,className:"organization-description",value:this.description,placeholder:j.DescriptionPlaceholder,multiline:!0,onChange:(e,t)=>this._onChange(this.description,t),disabled:!e.hasModifyPermissions}),a(j.TimeZone),i.createElement(k.Dropdown,{className:"organization-timezone",ariaLabel:j.AriaTimeZone,items:this.options,onSelect:this.onComboChanged,selection:this._timeZoneSelection,disabled:!e.hasModifyPermissions}),e.geography?i.createElement(i.Fragment,null,a(j.Geography),i.createElement("div",{className:"organization-geography"},e.geography),i.createElement(u.Link,{target:"_blank",rel:"noopener noreferrer",href:j.GeographyLearnMoreLink},j.GeographyLearnMore)):null,a(j.Region),i.createElement("div",null,e.region),e.hasModifyPermissions?i.createElement("div",{className:"organization-save flex-row flex-center top-margin"},i.createElement(o.Button,{className:"organization-edit-button",primary:!0,disabled:!this.isEdited||this.state.updateInProgress,onClick:this._onSaveClick},j.SaveButton),this.state.updateInProgress?i.createElement(I.Spinner,{className:"small-left-margin",size:"large"}):null,i.createElement(b.Icon,{className:"small-left-margin",iconName:"Error"}),i.createElement("span",{className:"small-left-margin edit-warning"},j.ChangesWarning)):null,i.createElement("div",{className:"overview-divider"}))),this.state.showRenameDialog?i.createElement(h.WrappedComponent,{dependencies:["ms.vss-admin-web.admin-common"],wrappedType:"ms.vss-admin-web.rename-dialog",wrappedProps:{name:e.name,onCancel:()=>this.setState({showRenameDialog:!1}),onRename:this._onRename,renameDialogTitle:j.RenameOrganizationDialogTitle,renameDialog1:j.RenameOrganizationDialog1,renameDialog2:j.RenameOrganizationDialog2,renameDialog2Link:j.RenameOrganizationDialog2Link,renameConfirmationText:j.RenameOrganizationConfirmationText,renameNewName:j.RenameOrganizationNewName,invalidNameMessage:j.InvalidOrganizationNameMessage,newName:this.name.value,url:this.state.data.url,validateName:z.validateOrganizationName}}):null,this.state.showMigrationDialog?i.createElement(w.Dialog,{onDismiss:()=>{this._onCancelToggle()},contentSize:0,className:"organization-migration-dialog",titleProps:{text:j.ChangeOrganizationDomain,className:"fontWeightSemiBold"},footerButtonProps:[{text:j.Cancel,onClick:()=>{this._onCancelToggle()}},{disabled:!1,text:j.SaveButton,onClick:this._saveMigration,primary:!0}]},j.ChangeOrganizationText):null,(0,v.isFeatureFlagEnabled)(this.context.pageContext,"ResourceUsage.Service.TeamProjectCollection",!1)?i.createElement(i.Fragment,null,i.createElement("div",null,i.createElement(U.ResourceUsageComponent,{source:"OrganizationOverview",projectId:"",resourceUsageName:"Organization Usage Limit"}),i.createElement("div",{className:"overview-divider"}))):null,t?i.createElement("div",null,i.createElement(A.ChangeOwner,{pageContext:this.context.pageContext,onChangeOwner:this._onChangeOwner,organizationName:this.state.data.name,owner:t.currentOwner,hasModifyPermissions:t.hasModifyPermissions,hasDeletePermissions:t.hasDeletePermissions,isOwner:t.isOwner,organizationTakeover:t.organizationTakeover,organizationId:e.id}),i.createElement(W.SoftDeletedProjects,{pageContext:this.context.pageContext}),t.hasDeletePermissions?i.createElement(V.DeleteOrganization,{pageContext:this.context.pageContext,organizationId:this.state.data.id,organizationName:this.state.data.name}):null):null,this.state.showChangeImageDialog&&i.createElement(h.WrappedComponent,{dependencies:["ms.vss-features.ui-avatar-image-picker-content"],wrappedType:"vss.avatar-image-picker",wrappedProps:{onCancel:this._cancelImageUpload,onSave:this._saveImageAction,onFileSelected:this._onImageFileSelected,onLoadDisplayAvatarUrl:this.avatarUrl,title:j.ChangeImageTitle,showInitialsOnImageError:!0,displayName:this.state.data.name,defaultResetAvatarUrl:null}})))}_onImageFileSelected(e,t){const a={};return e?(a.previewImage=!1,a.error=e):(a.previewImage=!0,a.error=""),a}_saveImage(e){this.setState({showChangeImageDialog:!1,imageUpdateInProgress:!0});const t=this._startActionCapture("Set Organization Avatar",{});return(0,a.getOrganizationClient)(this.context.pageContext).updateCollectionAvatar(this.state.data.id,e.byteArray).then((async()=>{this.setState({imageUpdateInProgress:!1})}),(e=>{this.setState({error:e.message||String(e),imageUpdateInProgress:!1}),t.captureError(e.message||String(e))}))}_removeImage(){this.setState({showChangeImageDialog:!1,imageUpdateInProgress:!0});const e=this._startActionCapture("Remove Organization Avatar",{});return(0,a.getOrganizationClient)(this.context.pageContext).deleteCollectionAvatar(this.state.data.id).then((async()=>{this.setState({imageUpdateInProgress:!1})}),(t=>{this.setState({error:t.message||String(t),imageUpdateInProgress:!1}),e.captureError(t.message||String(t))}))}getOrganizationImage(){return i.createElement("div",{className:"vss-Persona flex-noshrink organization-persona top-margin extra-extra-large",role:"img","aria-label":"AzureDevOps"},i.createElement("img",{className:"vss-Persona-content using-image",src:this.avatarUrl,alt:"Organization logo"}))}getNewOrganizationImage(){var e=this.state.data;return this.state.imageUpdateInProgress?i.createElement("div",null,i.createElement("span",null,i.createElement(I.Spinner,{size:"large",className:"imageSpinner"}))):e.hasModifyPermissions?i.createElement("div",null,i.createElement("div",{className:"persona-list-element profile-card-tab-element image-container","aria-label":j.ChangeImageClick,onClick:this._onChangeImageClick,"data-is-focusable":!0,role:"button",tabIndex:0,onKeyDown:this._onChangeImageKeyDown},this.getOrganizationImage(),i.createElement("div",{className:"overlay"}),i.createElement(b.Icon,{iconName:"Edit",className:"ms-font-l editIcon"}))):this.getOrganizationImage()}getOldOrganizationImage(){return i.createElement(l.VssAuthenticatedPersona,{identityDetailsProvider:{getIdentityImageUrl:e=>{},getDisplayName:()=>this.state.data.name},size:"extra-extra-large",cssClass:"organization-persona top-margin"})}_getOptions(e){let t=[];if(t.push({id:this.state.data.timeZone.id,text:this.state.data.timeZone.displayName}),e&&this.state.delayLoadData)for(let e in this.state.delayLoadData.allTimeZones){let a=this.state.delayLoadData.allTimeZones[e].id;a!==this.state.data.timeZone.id&&t.push({id:a,text:this.state.delayLoadData.allTimeZones[e].displayName})}return t}async _waitForDomainMigrationComplete(e,t){await e.waitChangeDomainCompletion(this.context).then((async e=>{e?this.setState({updateInProgress:!1}):((0,C.announce)(j.FailedMigration),this.setState({updateInProgress:!1,error:j.FailedMigration,domainToggle:this.state.delayLoadData?this.state.delayLoadData.devOpsDomainUrls:!this.state.domainToggle}),t.captureError("No value returned from waitChangeDomainCompletion"))}),(e=>{(0,C.announce)(e.message),this.setState({updateInProgress:!1,error:e.message||String(e),domainToggle:this.state.delayLoadData?this.state.delayLoadData.devOpsDomainUrls:!this.state.domainToggle}),t.captureError(e.message)}))}_triggerSaveDialog(){this._startActionCapture("Show rename dialog",{}),this.setState({showRenameDialog:!0,updateInProgress:!1})}_onChangeOwner(e){var t=this.state.delayLoadData,a=this.state.data;t&&(t.currentOwner=e,t.currentUserId===e.id&&(t.hasDeletePermissions=!0,t.hasModifyPermissions=!0,a.hasModifyPermissions=!0),this.setState({delayLoadData:t,data:a}))}async _refreshProperties(){let e=this.state.data;e.description=this.description.value,e.timeZone.id=this.state.timeZone.id,e.timeZone.displayName=this.state.timeZone.displayName,e.privacyUrl=this.privacyUrl.value,(0,C.announce)(j.UpdateDetailsSuccess),this.setState({data:e,updateInProgress:!1,success:j.UpdateDetailsSuccess})}async _refreshPageForRename(e){const t=this.context.pageContext.getService("IVssContributionService");var a=this._startActionCapture("Refresh page for rename",{});try{let a=0;for(;!0===this.state.updateInProgress&&a++<100;){var r=await t.getDataAsync(M.OrganizationDataProvidersContributions.EditDataProviderId,void 0,!0);r&&r.name===e&&this.state.data.url!==r.url&&(window.location.href.includes(this.state.data.url)?this._changeUrl(this.state.data.url,r.url):this._changeUrl(this.state.data.name,e||this.state.data.name)),await(0,g.wait)(M.ConstantNumbers.ProgressPollInterval)}}catch(t){-1!=t.message.indexOf("404")?a.captureError("Changing to rename url"):a.captureError(t.message),this._changeUrl(this.state.data.name,e||this.state.data.name)}}componentDidMount(){super.componentDidMount();this.context.pageContext.getService("IVssPerformanceService").markTimeToInteractive(m.Area.Admin,m.Feature.OrganizationOverview),this._updateDelayLoad()}async _updateDelayLoad(){var e=this.context.pageContext.getService("IVssContributionService"),t=await e.getDataAsync(M.OrganizationDataProvidersContributions.DelayLoadDataProviderId);this.setState({delayLoadData:t,domainToggle:!!t&&t.devOpsDomainUrls})}}t[e].OrganizationOverviewComponent=r,h.Components.add("organizationOverview",r)}("OrganizationOverview")}),["Resources","Constants/Constants","Contracts/DataModels","Sources/OrganizationOverviewSources","Components/ChangeOwner/ChangeOwner","Components/DeleteOrganization/DeleteOrganizationDialog","Components/DeleteOrganization/DeleteOrganization","Components/SoftDeletedProjects/RestoreDialog","Components/SoftDeletedProjects/RestoreTable","Components/SoftDeletedProjects/SoftDeletedProjects","OrganizationOverview"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-admin-web.admin-organization-overview-content"}}));